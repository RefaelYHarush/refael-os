# משימות לתיקון ושיפור הכשלונות

מבוסס על `WHERE_THE_SITE_FAILS.md`.  
**סימון:** ☐ לא בוצע | ☑ בוצע  
**יושם:** פברואר 2026 – כל המשימות בוצעו.

---

## עדיפות גבוהה

### ג1. OAuth – הצגת הודעת שגיאה/ביטול אחרי חזרה מגוגל

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| ג1.1 | לקרוא את `window.location.hash` לפני ניקוי ה־URL; אם יש `error=` (למשל `access_denied`) – לשמור את קוד/טקסט השגיאה ב־state או להעביר ל־AuthView | `AuthContext.jsx` | ☑ |
| ג1.2 | להעביר את הודעת השגיאה מ־AuthContext ל־AuthView (למשל דרך context value: `oauthError` / `setOauthError`, או קריאת hash ב־AuthView ב־mount) | `AuthContext.jsx`, `AuthView.jsx` | ☑ |
| ג1.3 | ב־AuthView: להציג הודעה ברורה כשהתחברות גוגל בוטלה או נכשלה (למשל: "ההתחברות עם גוגל בוטלה" עבור `access_denied`, "אירעה שגיאה בהתחברות" לכל השאר) | `AuthView.jsx` | ☑ |
| ג1.4 | לנקות את ה־hash רק אחרי שקראנו את ה־error (או אחרי שהצגנו את ההודעה), כדי שלא לאבד את המידע | `AuthContext.jsx` | ☑ |

**תוצאה:** משתמש שמבטל התחברות גוגל יראה הודעה ברורה במקום מסך ריק.

---

### ג2. יומן – הצגת שגיאות בטעינת רשימת היומנים

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| ג2.1 | ב־CalendarView: להוסיף state `calendarsError` (בדומה ל־`eventsError`) | `CalendarView.jsx` | ☑ |
| ג2.2 | ב־`loadCalendars`: לקבל גם `error` מהתוצאה של `fetchCalendarList`; אם יש `error` – לקרוא ל־`setCalendarsError(error)`; אחרת לאפס את `calendarsError` | `CalendarView.jsx` | ☑ |
| ג2.3 | ב־UI של בחירת יומן: להציג את `calendarsError` כשהשדה לא ריק (אותו סגנון כמו `eventsError` – תיבה/טקסט אזהרה) | `CalendarView.jsx` | ☑ |

**תוצאה:** כשטעינת היומנים נכשלת, המשתמש רואה הודעת שגיאה במקום רשימה ריקה ללא הסבר.

---

## עדיפות בינונית

### ב1. שמירת פרופיל יומן – הצגת כישלון למשתמש

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| ב1.1 | ב־AppContext, ב־useEffect של `saveCalendarProfile`: ב־callback של `onError` להוסיף `setSyncError('שגיאה בשמירת הגדרות היומן – נשמר מקומית')` (בנוסף ל־console.warn אם רוצים) | `AppContext.jsx` | ☑ |

**תוצאה:** כששמירת קישור embed / יומן נבחר ל־Supabase נכשלת, המשתמש יראה את האזהרה ב־Layout כמו בשאר הסנכרונים.

---

### ב2. SaaS – הצגת שגיאה בגרירה (drag & drop)

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| ב2.1 | ב־SaasView: להוסיף state למשוב שגיאה, למשל `dropError` (string או null) | `SaasView.jsx` | ☑ |
| ב2.2 | ב־`handleDrop`: בתוך ה־catch – להציב הודעה ב־`dropError` (למשל "שגיאה בעדכון הסטטוס – נסה שוב") ו־setTimeout לאיפוס אחרי 4–5 שניות | `SaasView.jsx` | ☑ |
| ב2.3 | מעל או מתחת ללוח העמודות: להציג את `dropError` כשהערך לא ריק (תיבה אדומה/כתומה, עם כפתור "סגור" לאיפוס) | `SaasView.jsx` | ☑ |

**תוצאה:** אם גרירה נכשלת, המשתמש יראה הודעה ברורה במקום "שום דבר לא קרה".

---

### ב3. איפוס סיסמה – תמיכה ב־query params (אופציונלי)

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| ב3.1 | ב־ResetPasswordPage: לבדוק גם `window.location.search` ל־`type=recovery` (בנוסף ל־hash), כדי לתמוך בקישורים עם query params אם Supabase ישנה בעתיד | `ResetPasswordPage.jsx` | ☑ |
| ב3.2 | לתעד ב־הערה או ב־docs שתמיכה באיפוס היא ב־hash (ו־query אם בוצע ב3.1) | `ResetPasswordPage.jsx` או `docs/` | ☑ |

**תוצאה:** פחות סיכון שקשרים עתידיים של איפוס לא יעבדו.

---

## עדיפות נמוכה (שיפורי UX)

### נ1. אינדיקציה מתמשכת ל"ללא סנכרון"

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| נ1.1 | להחליט איפה להציג אינדיקציה: בכותרת Layout (ליד הלוגו) או בתחתית הסרגל (טקסט קטן / אייקון) | `Layout.jsx` | ☑ |
| נ1.2 | כשקיים `syncError` (ולאחר שהמשתמש סגר את הבאנר) – להציג אייקון/טקסט קבוע עדין, למשל "אין סנכרון" או אייקון ענן עם X, עם tooltip או קישור להסבר | `Layout.jsx`, `AppContext.jsx` | ☑ |

**תוצאה:** גם אחרי סגירת האזהרה, המשתמש יודע שהמערכת במצב "מקומי" ולא מסונכרן.

---

### נ2. גרף 7 ימים – הודעה כשאין נתונים

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| נ2.1 | ב־DashboardView, באזור הגרף של 7 ימים: אם `last7DaysChartData` ריק (אין עסקאות ב־7 ימים) – להציג טקסט מרכזי: "אין נתונים ל־7 הימים האחרונים" (במקום גרף ריק בלבד) | `DashboardView.jsx` | ☑ |

**תוצאה:** משתמש לא ירגיש שהגרף "שבור" כשאין עסקאות.

---

### נ3. משימות גוגל – טקסט עזרה כשאין טוקן

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| נ3.1 | ב־GoogleTasksCard: כשמשתמש מחובר אבל אין `accessToken` (או כש־taskLists ריק ו־!hasToken) – להציג משפט עזרה: "כדי לראות משימות גוגל, התחבר מחדש עם גוגל ואשר גישה ל־Google Tasks" (או דומה) | `GoogleTasksCard.jsx` | ☑ |

**תוצאה:** ברור למשתמש למה אין רשימות ואיך לתקן.

---

### נ4. הודעות סנכרון ספציפיות (שיפור אופציונלי)

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| נ4.1 | ב־AppContext: להעביר ל־setSyncError הודעות שונות לפי סוג השמירה שנכשלה (למשל "שגיאה בסנכרון המסחר", "שגיאה בסנכרון המשימות", "שגיאה בסנכרון הפרופיל") – במקום אותה הודעה גנרית לכל הכישלונות | `AppContext.jsx` | ☑ |

**תוצאה:** משתמש יודע איזה חלק נכשל (מסחר / משימות / וכו').

---

## משימות מהדוח הקודם (AUDIT / TASK_LIST)

כדי שלא להשאיר "כפתורים מתים":

| # | משימה | קובץ | סטטוס |
|---|--------|------|--------|
| ק1 | חיבור כפתור "פרויקט חדש" ב־SaaS למודל/דף הוספת פרויקט (AddSaasProjectModal כבר קיים – לוודא שהוא נפתח) | `SaasView.jsx` | ☑ |
| ק2 | חיבור כפתור "פרטי עסקה" (ChevronRight) בטבלת המסחר – לפתוח מודל/דף פרטי עסקה או עריכה | `TradingView.jsx` | ☑ |

---

## סדר ביצוע מומלץ

1. **ג1** – OAuth (חוויית ביטול/שגיאה)
2. **ג2** – שגיאות רשימת יומנים
3. **ב1** – שמירת פרופיל יומן
4. **ב2** – SaaS גרירה
5. **ק1, ק2** – כפתורים מתים (אם עדיין רלוונטי)
6. **נ2** – גרף 7 ימים ריק
7. **נ3** – עזרה ב־Google Tasks
8. **ב3** – איפוס סיסמה (params)
9. **נ1** – אינדיקציה מתמשכת סנכרון
10. **נ4** – הודעות סנכרון ספציפיות

---

## סיכום

| עדיפות | כמות משימות | נושאים |
|--------|-------------|--------|
| גבוהה | 7 (ג1 + ג2) | OAuth, יומן – שגיאות |
| בינונית | 5 (ב1 + ב2 + ב3) | שמירת יומן, SaaS גרירה, איפוס סיסמה |
| נמוכה | 6 (נ1–נ4) | אינדיקציה סנכרון, גרף ריק, Tasks עזרה, הודעות ספציפיות |
| השלמות | 2 (ק1, ק2) | כפתור פרויקט חדש, פרטי עסקה |

**סה"כ:** 20 משימות. לאחר ביצוע – לעדכן סטטוס ב־`WHERE_THE_SITE_FAILS.md` או לסמן ☑ כאן.
